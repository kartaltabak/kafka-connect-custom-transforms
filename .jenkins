pipeline {
    agent {
        docker {
            image 'kartaltabak/jdk-with-docker:jdk11'
            args '-v /var/lib/jenkins/tools:/var/lib/jenkins/tools ' +
                    '-v /var/lib/jenkins/repositoryPlugin:/var/lib/jenkins/repositoryPlugin ' +
                    '-v maven-dir:/var/shared/maven-dir ' +
                    '-v jenkins-maven-cache:/home/jenkins/.m2/ ' +
                    '--network jenkins-network '
        }
    }
    options {
        timeout(time: 1, unit: 'HOURS')
        disableConcurrentBuilds()
    }
    triggers {
        snapshotDependencies()
    }
    stages {
        stage('Build') {
            steps {
                sh './gradlew --no-daemon clean build publish -DaltDeploymentRepository=file:///var/shared/maven-dir'
            }
            post {
                always {
                    // Archive the build artifacts if needed
                    archiveArtifacts artifacts: '**/build/libs/*.jar', allowEmptyArchive: true

                    // Publish test results (if any)
                    junit '**/build/test-results/test/*.xml'
                }
            }
        }
    }
}
